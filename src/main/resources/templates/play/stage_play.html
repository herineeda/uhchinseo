<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8" />
        <meta name="description" content="어색한 친구를 소개합니다." />
        <meta name="author" content="번개탄소년단" />
        <title>어친소</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="/css/styles.css" rel="stylesheet" />
        <script src="http://code.jquery.com/jquery-latest.js"></script>
    </head>
    <body id="page-top">
    <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
            <div class="container">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars ms-1"></i>
                </button>
                <div id="navbarResponsive">
                    <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0 text-shadow">
                        <li class="nav-item"><a class="nav-link" href="../index.html#portfolio">GAMES</a></li>
                        <li class="nav-item"><a class="nav-link" href="../index.html#team">ABOUT</a></li>
                    </ul>
                </div>
                <!-- 닉네임 표시 위치-->
                <!-- css와 js로 닉네임이 없으면 -> 닉네임 설정 버튼만 활성화 / 닉네임 설정 후 -> 변경 버튼만 활성화  -->
                <div class="text-shadow">
                    <p id="nickname-area" class='no_p'>닉네임을 설정해주세요.</p>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead">
            <div class="container">
                <div class="masthead-heading-2-score text-uppercase">score : 38 </div>
                <div class="masthead-heading-1 text-uppercase">어떤 무대인지 맞춰라!!</div>
            </div>
        </header>

        <!-- 게임 화면 -->
        <section class="page-section bg-dark" style="padding-top:0rem;">
            <div class="container">
                <div class="text-center">
                <div class="row">
                    <div class="text-center">
                        <img class="col-lg-5 mx-auto" style="padding-bottom: 4rem;" src="/assets/img/games_intro/stage_intro.jpg" alt="..." />
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4" style="padding-top:2.5rem; padding-bottom: 2.5rem; font-size: 2rem; "><div class="answer-wrong answer"><button class="first">선택지1</button></div></div>
                    <div class="col-lg-4" style="padding-top:2.5rem; padding-bottom: 2.5rem; font-size: 2rem;"><div class="answer-right answer"><button class="second">선택지2</button></div></div>
                    <div class="col-lg-4" style="padding-top:2.5rem; padding-bottom: 2.5rem; font-size: 2rem;"><div class="answer"><button class="third">선택지3</button></div></div>

                    <div>
                        <table>
                            <tr th:each="musicStage : ${musicStageGameList}" style="display: none">
                                <td class="invisible-but-need" th:text="${musicStage.singer} +' - '+${musicStage.music} +'/'+${musicStage.answer}" style="display: none"></td>
                            </tr>
                        </table>
                    </div>

                </div>

                <div class="row">
                    <div class="next-text" style="padding-top:2.5rem; padding-bottom: 2.5rem;" >
                        <button id="show_answer"> ▶ 정답 보기</button></div>
                    <!-- 정답보기 버튼 클릭하면 정답보기 버튼 없어지고 다음으로 넘어가는 버튼 보이게 하기 -->
                    <div><button id="next-text" style="padding-top:2.5rem; padding-bottom: 2.5rem;">▶ next</button></div>
                    <!-- 지금 문제가 마지막 문제인 경우 정답보기 버튼 클릭하면 정답보기 버튼 없어지고 결과 보는 버튼 보이게 하기 -->
                    <div class="next-text" style="padding-top:2.5rem; padding-bottom: 2.5rem; display: none;">▶ result</div>
                </div>
            </div>
            </div>
        </section>

        <!-- Footer-->
        <footer class="footer py-2 fixed-bottom">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-12 text-shadow" style="color: #FFF; font-size: 1.24rem;">Copyright &copy; TINGTINGTAENGTAENG</div>
                </div>
            </div>
        </footer>

        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="/js/name.js"></script>
        </div>
        <script th:inline="javascript">
            const answerList = [];
            const singerList = [];
            const musicList = [];
            const imgList =[];
            let pageNum = 1 ;

            let f_arr =[];
            let s_arr1;
            let s_arr2;
            let s_arr3;
            let answer_arr = [];

            /*<![CDATA[*/

            /*[# th:each="musicStage : ${musicStageGameList}"]*/
            answerList.push(/*[[${musicStage.answer}]]*/);
            singerList.push(/*[[${musicStage.singer}]]*/);
            musicList.push(/*[[${musicStage.music}]]*/);
            /*[/]*/

            /*]]>*/

            //
            document.querySelector('.first').innerHTML = singerList[0]+' - '+musicList[0];
            document.querySelector('.second').innerHTML = singerList[1]+' - '+musicList[1];
            document.querySelector('.third').innerHTML = singerList[2]+' - '+ musicList[2];

            answer_arr[0] = answerList[0];
            answer_arr[1] = answerList[1];
            answer_arr[2] = answerList[2];
            console.log(answer_arr);


            // next버튼 눌렀을 때 api재 호출하기 (pageNum +1 해서)
            let next_btn;
            next_btn = document.getElementById('next-text');
            next_btn.addEventListener('click', function(){
                console.log('버튼 클릭!');
                pageNum += 1;

                if (pageNum==10){
                    document.getElementById('show_result').style.display ='block';
                    next_btn.style.display='none';
                }
                console.log(pageNum)
                fetch(`http://localhost:8081/musicGame?pageNum=${pageNum}`)
                    .then(res => res.text())
                    .then(res => {
                        console.log(res)
                        f_arr = res.split("<td class=\"invisible-but-need\" style=\"display: none\">")
                        s_arr1 = f_arr[1].split('/');
                        s_arr2 = f_arr[2].split('/');
                        s_arr3 = f_arr[3].split('/');

                        // 정답 배열로 저장
                        answer_arr[0] = s_arr1[1];
                        answer_arr[1] = s_arr2[1];
                        answer_arr[2] = s_arr3[1];

                        document.querySelector('.first').innerHTML = s_arr1[0];
                        document.querySelector('.second').innerHTML = s_arr2[0];
                        document.querySelector('.third').innerHTML = s_arr3[0];

                        console.log(answer_arr);
                    });
            });

        </script>
    </body>
</html>
